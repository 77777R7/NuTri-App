import { useEffect, useMemo, useState } from 'react';
import * as Localization from 'expo-localization';

const translations = {
  en: {
    homeTitle: 'Dashboard',
    welcome: 'Welcome back',
    homeSubtitle: 'Track your supplements and stay balanced.',
    greetingMorning: 'Good morning',
    loginGoogle: 'Sign in with Google',
    loginApple: 'Sign in with Apple',
    logout: 'Sign out',
    recentScans: 'Recent Scans',
    recommended: 'Recommended for you',
    emptyScans: 'No scans yet. Start by scanning a supplement.',
    emptyRecommendations: 'Recommendations will appear here once available.',
    profile: 'Profile',
    calendarTitle: 'This week',
    quickActionsTitle: 'Quick actions',
    savedVitaminsTitle: 'Saved vitamins',
    supplementListTitle: 'My supplements',
    recentlyUploadedTitle: 'Recently uploaded',
    emptySavedVitamins: 'Save vitamins to keep them handy.',
    emptyUploads: 'Uploads will show here after you scan a product.',
    quickActionSaved: 'Saved vitamins',
    quickActionSavedCaption: 'View saved list',
    quickActionScan: 'Scan vitamin',
    quickActionScanCaption: 'Capture and analyze',
    quickActionDatabase: 'Vitamin database',
    quickActionDatabaseCaption: 'Browse catalog',
    quickActionAI: 'AI assistance',
    quickActionAICaption: 'Ask anything about supplements',
    todaysOverview: "Today's overview",
    addOptionsTitle: 'What would you like to do?',
    addButtonLabel: 'Add',
    statusReady: 'Ready',
    statusProcessing: 'Processing',
    todayLabel: 'Today',
    yesterdayLabel: 'Yesterday',
    balanceMode: 'Balance mode',
    calendarEmptyState: 'Supplements scheduled for this day will appear here.',
    viewDetails: 'Open',
    overviewEmpty: 'Keep tracking supplements to see your daily progress here.',
    loading: 'Loading...',
    dashboardLoadError: 'Unable to load dashboard data. Pull to refresh.',
    savedPageDescription: 'Your saved vitamins stay in sync across devices. Tap a card to view details.',
    databaseTitle: 'Vitamin database',
    databaseSubtitle: 'Search our curated catalog to explore supplements, ingredients, and brands.',
    databasePlaceholder: 'Search supplement name, brand, or goal',
    databaseSearchCta: 'Search database',
    databaseResultsTitle: 'Results',
    databaseNoResults: 'No matches found. Try adjusting your keywords.',
    databaseIdleHint: 'Start by entering a query above to explore the catalog.',
    databaseEnterQuery: 'Please enter a keyword before searching.',
    databaseSearchFailed: 'Failed to search the database. Try again.',
    unknownCategory: 'Uncategorized',
    unknownBrand: 'Unknown brand',
    unknownSupplement: 'Unknown supplement',
    assistantTitle: 'AI assistance',
    assistantSubtitle: 'Ask NuTri AI about supplements, ingredients, interactions, or best usage practices.',
    assistantPlaceholder: 'Ask about dosage, interactions, or nutrition goals...',
    assistantSendCta: 'Ask NuTri AI',
    assistantResponseTitle: 'AI response',
    assistantIdleHint: 'Your AI insights will appear here once you ask a question.',
    assistantEnterPrompt: 'Please enter a question first.',
    assistantRequestFailed: 'Assistant request failed. Please try again.',
    progressTitle: 'Progress overview',
    progressSubtitle: 'Track your streaks and daily actions.',
    progressTargetPrefix: 'Target',
    progressUploadsTitle: 'Upload activity',
    progressUploadsSubtitle: 'Recent scans and processing status.',
    progressUploadsHint: 'Keep scanning supplements to unlock more insights.',
    progressUploadsEmpty: 'No uploads yet. Start by scanning a supplement on the Home tab.',
    progressRewardsTitle: 'Rewards roadmap',
    progressRewardsSoon: 'Coming soon',
    progressRewardsDescription: 'We are working on a reward system that celebrates your consistency and wellness wins.',
    progressBadgeTracker: 'Consistency badge',
    progressBadgeTrackerHint: 'Scan supplements at least 5 days in a row to unlock streak rewards.',
    progressHydrationBadge: 'Hydration hero',
    progressHydrationHint: 'Log hydration every day to keep your body in balance.',
    userTitle: 'Account',
    userSubtitle: 'Manage your NuTri account and preferences.',
    userPlanLabel: 'Membership',
    userPlanFree: 'Free',
    userPlanHint: 'Upgrade coming soon with personalized insights and reminders.',
    userRoleLabel: 'Role',
    userRoleMember: 'Member',
    userAccountIdLabel: 'Account ID',
    userSignOut: 'Sign out',
    userSignedOut: 'Sign in to sync your scans, saved vitamins, and AI conversations.',
    userSignInCta: 'Go to Home to sign in',
    userPreferencesTitle: 'Wellness preferences',
    userPreferencesDescription: 'We are building more customization options to fine-tune your routine.',
    userNotificationsTitle: 'Reminders',
    userNotificationsHint: 'Set gentle nudges to stay consistent once reminders are available.',
    userDataControlTitle: 'Data control',
    userDataControlHint: 'Control what data NuTri keeps and request exports in one place.',
  },
  zh: {
    homeTitle: '概览',
    welcome: '欢迎回来',
    homeSubtitle: '追踪你的补充剂，保持健康平衡。',
    greetingMorning: '早上好',
    loginGoogle: '使用 Google 登录',
    loginApple: '使用 Apple 登录',
    logout: '退出登录',
    recentScans: '最近扫描',
    recommended: '为你推荐',
    emptyScans: '暂时没有扫描记录，点击立即扫描。',
    emptyRecommendations: '这里将展示推荐的补充剂。',
    profile: '我的资料',
    calendarTitle: '本周安排',
    quickActionsTitle: '快捷操作',
    savedVitaminsTitle: '已保存的补充剂',
    supplementListTitle: '我的补充剂',
    recentlyUploadedTitle: '最近上传',
    emptySavedVitamins: '保存补充剂以便快速查看。',
    emptyUploads: '扫描后会在这里显示上传记录。',
    quickActionSaved: '已保存',
    quickActionSavedCaption: '查看清单',
    quickActionScan: '扫描补充剂',
    quickActionScanCaption: '拍摄并分析',
    quickActionDatabase: '补充剂数据库',
    quickActionDatabaseCaption: '浏览全部条目',
    quickActionAI: 'AI 助手',
    quickActionAICaption: '咨询补充剂问题',
    todaysOverview: '今日概览',
    addOptionsTitle: '想要进行什么操作？',
    addButtonLabel: '添加',
    statusReady: '已完成',
    statusProcessing: '处理中',
    todayLabel: '今天',
    yesterdayLabel: '昨天',
    balanceMode: '平衡模式',
    calendarEmptyState: '当天安排的补充剂会显示在这里。',
    viewDetails: '查看',
    overviewEmpty: '继续记录补充剂，数据会显示在这里。',
    loading: '加载中...',
    dashboardLoadError: '无法加载首页数据，轻下拉即可刷新。',
    savedPageDescription: '你保存的补充剂会在不同设备间同步，点击卡片查看详情。',
    databaseTitle: '补充剂数据库',
    databaseSubtitle: '搜索我们精选的补充剂、成分和品牌库，获取权威信息。',
    databasePlaceholder: '输入补充剂名称、品牌或功效',
    databaseSearchCta: '开始搜索',
    databaseResultsTitle: '搜索结果',
    databaseNoResults: '没有找到匹配项，尝试换个关键词。',
    databaseIdleHint: '先输入关键词即可浏览数据。',
    databaseEnterQuery: '请输入关键词再进行搜索。',
    databaseSearchFailed: '搜索失败，请稍后重试。',
    unknownCategory: '未分类',
    unknownBrand: '未知品牌',
    unknownSupplement: '未知补充剂',
    assistantTitle: 'AI 助手',
    assistantSubtitle: '向 NuTri AI 咨询补充剂、成分、相互作用或使用建议。',
    assistantPlaceholder: '例如：维生素D每天摄入多少合适？',
    assistantSendCta: '询问 NuTri AI',
    assistantResponseTitle: 'AI 回答',
    assistantIdleHint: '提出问题后，智能分析会显示在这里。',
    assistantEnterPrompt: '请先输入问题。',
    assistantRequestFailed: '请求失败，请稍后再试。',
    progressTitle: '进度概览',
    progressSubtitle: '追踪你的连续记录和每日动作。',
    progressTargetPrefix: '目标',
    progressUploadsTitle: '上传记录',
    progressUploadsSubtitle: '最近扫描与处理进度。',
    progressUploadsHint: '继续扫描补充剂以解锁更多洞察。',
    progressUploadsEmpty: '还没有上传记录，可在首页开始扫描补充剂。',
    progressRewardsTitle: '奖励计划',
    progressRewardsSoon: '即将上线',
    progressRewardsDescription: '我们正在打造奖励体系，为你的坚持与健康成果庆祝。',
    progressBadgeTracker: '连续打卡徽章',
    progressBadgeTrackerHint: '连续5天扫描补充剂即可解锁连续奖励。',
    progressHydrationBadge: '饮水达人',
    progressHydrationHint: '每日记录饮水量，保持身体平衡。',
    userTitle: '账户',
    userSubtitle: '管理 NuTri 账户与个性化设置。',
    userPlanLabel: '会员计划',
    userPlanFree: '免费',
    userPlanHint: '即将推出升级版，提供个性化洞察和提醒服务。',
    userRoleLabel: '角色',
    userRoleMember: '普通用户',
    userAccountIdLabel: '账户编号',
    userSignOut: '退出登录',
    userSignedOut: '登录后即可同步你的扫描记录、收藏以及 AI 对话。',
    userSignInCta: '回到首页登录',
    userPreferencesTitle: '健康偏好',
    userPreferencesDescription: '我们正在打造更多个性化设置，帮助你更好地管理日常。',
    userNotificationsTitle: '提醒设置',
    userNotificationsHint: '提醒功能上线后，可设置温柔提示保持好习惯。',
    userDataControlTitle: '数据控制',
    userDataControlHint: '未来可在此管理数据留存与导出申请。',
  },
};

type TranslationKeys = keyof typeof translations.en;

type TranslationMap = Record<TranslationKeys, string>;

const getLocale = () => {
  const locale = Localization.getLocales()[0]?.languageCode ?? 'en';
  if (locale.toLowerCase().startsWith('zh')) return 'zh';
  return 'en';
};

export const useTranslation = () => {
  const [locale, setLocale] = useState<'en' | 'zh'>(getLocale());

  useEffect(() => {
    setLocale(getLocale());
  }, []);

  const t = useMemo(() => translations[locale] as TranslationMap, [locale]);

  return { t, locale };
};
